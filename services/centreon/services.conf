apply Service "CPU-processors" {
  import "generic-service"
  name = "CPU-Processors"
  check_command = "oc_centreon_plugins_snmp_linux_cpu"
  assign where (host.address || host.address6) && host.vars.os == "linux" && host.vars.snmp_community
}

apply Service "CPU-kernel" {
  import "generic-service"
  name = "CPU-Kernel"
  check_command = "oc_centreon_plugins_snmp_linux_cpu_detailed"
  assign where (host.address || host.address6) && host.vars.os == "linux" && host.vars.snmp_community
}

apply Service "RAM" {
  import "generic-service"
  check_command = "oc_centreon_plugins_snmp_linux_memory"
  assign where (host.address || host.address6) && host.vars.os == "linux" && host.vars.snmp_community
}

apply Service "CPU-average" {
  import "generic-service"
  name = "CPU-Average"
  check_command = "oc_centreon_plugins_snmp_linux_load"
  assign where (host.address || host.address6) && host.vars.os == "linux" && host.vars.snmp_community
}

apply Service "UPTIME" {
  import "generic-service"
  check_command = "oc_centreon_plugins_snmp_linux_uptime"
  assign where (host.address || host.address6) && host.vars.os == "linux" && host.vars.snmp_community
}

apply Service for (path_name => config in host.vars.disk_paths) {
  import "generic-service"
  name = "Partition " + path_name
  check_command = "oc_centreon_plugins_snmp_linux_storage"
  vars += config
  assign where (host.address || host.address6) && host.vars.os == "linux" && host.vars.snmp_community
}

apply Service for (instance => conf in host.vars.x509) {
  import "generic-service"
  name = "Certificat " + instance.upper()
  check_command = "oc_centreon_plugins_protocols_x509_https"
  vars.cc_proto_x509_http_peer_addr = conf.nameserver
  vars.cc_proto_x509_header = conf.nameserver
  if ( conf.delay_warning ) {
        vars.cc_proto_x509_warning_status = "%{expiration} < " + conf.delay_warning
  }
  if ( conf.delay_critical ) {
    vars.cc_proto_x509_critical_status = "%{expiration} < " + conf.delay_critical
    if ( conf.subject ) {
      vars.cc_proto_x509_critical_status += " || %{subject} !~ '/" + conf.subject + "/'"
    }
    if ( conf.alt_subjects ) {
      vars.cc_proto_x509_critical_status += " || %{alt_subjects} !~ '/.*" + conf.alt_subjects + ".*/'"
    }
  }

  assign where (host.address || host.address6)
}

apply Service for (oid_name => config in host.vars.oids) {
  import "generic-service"
  name = oid_name
  check_command = "oc_centreon_plugins_protocols_snmp_numeric"
  vars += config
  assign where (host.address || host.address6) && host.vars.os == "linux" && host.vars.snmp_community
}

